# ğŸ—ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° RpcShield



## ĞĞ±Ğ·Ğ¾Ñ€ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹

RpcShield

 Ğ¿Ğ¾ÑÑ‚Ñ€Ğ¾ĞµĞ½ Ğ½Ğ° Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒĞ½Ğ¾Ğ¹ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğµ Ñ Ñ‡ĞµÑ‚ĞºĞ¸Ğ¼ Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸ĞµĞ¼ Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¼ĞµĞ¶Ğ´Ñƒ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Client Layer                         â”‚
â”‚  (Wallets, DApps, Bots, Scripts)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ HTTP/JSON-RPC
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              RpcShield

 (Port 8545)                 â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Identity   â”‚  â”‚     Rate     â”‚  â”‚    Stats     â”‚ â”‚
â”‚  â”‚   Resolver   â”‚  â”‚   Limiter    â”‚  â”‚  Collector   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                  â”‚                  â”‚         â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                    â†“                                     â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚         â”‚   Proxy Handler    â”‚                          â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Backend RPC Node (Port 8546)               â”‚
â”‚           (Geth, Erigon, Nethermind, etc.)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹

### 1. Identity Resolver

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ° Ğ¿Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑƒ

**Ğ›Ğ¾Ğ³Ğ¸ĞºĞ°:**
1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° `Authorization: Bearer <token>` Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²ĞºĞ°
2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° `X-API-Key` Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²ĞºĞ°  
3. Fallback Ğ½Ğ° IP-Ğ°Ğ´Ñ€ĞµÑ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°

**Ğ¢Ğ¸Ğ¿Ñ‹ Ğ¸Ğ´ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸:**
```rust
enum ClientIdentity {
    ApiKey(String),      // ĞĞ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ
    IpAddress(IpAddr),   // ĞĞ½Ğ¾Ğ½Ğ¸Ğ¼Ğ½Ñ‹Ğ¹ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ¿Ğ¾ IP
    Anonymous,           // ĞĞµĞ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ñ‘Ğ½Ğ½Ñ‹Ğ¹
}
```

**ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ñ‹:**
1. API ĞºĞ»ÑÑ‡ (Ğ²Ñ‹ÑÑˆĞ¸Ğ¹ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚ - Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ğµ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ñ‹)
2. IP Ğ°Ğ´Ñ€ĞµÑ (Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğµ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ñ‹)

### 2. Rate Limiter Engine

**ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼:** Token Bucket (Ñ‡ĞµÑ€ĞµĞ· `governor` crate)

**Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°:**
```rust
HashMap<String, RateLimiter>
Key = "identity:method"
// ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹:
// "apikey:abc123:eth_call"
// "ip:192.168.1.1:eth_getLogs"
```

**ĞŸÑ€Ğ¾Ñ†ĞµÑÑ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸:**
1. Ğ˜Ğ·Ğ²Ğ»ĞµÑ‡ÑŒ identity + method
2. ĞĞ°Ğ¹Ñ‚Ğ¸ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¹ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚ Ğ¸Ğ· ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³Ğ°
3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ quota Ğ² ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒÑÑ‰ĞµĞ¼ bucket
4. Ğ Ğ°Ğ·Ñ€ĞµÑˆĞ¸Ñ‚ÑŒ/Ğ¾Ñ‚ĞºĞ»Ğ¾Ğ½Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ

**Ğ£Ñ€Ğ¾Ğ²Ğ½Ğ¸ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ¾Ğ² (Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚ ÑĞ²ĞµÑ€Ñ…Ñƒ Ğ²Ğ½Ğ¸Ğ·):**
1. API ĞºĞ»ÑÑ‡ + ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğ¹ Ğ¼ĞµÑ‚Ğ¾Ğ´
2. ĞšĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğ¹ Ğ¼ĞµÑ‚Ğ¾Ğ´ (Ğ¸Ğ· config.method_limits)
3. Default IP Ğ»Ğ¸Ğ¼Ğ¸Ñ‚

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹ ĞºĞ²Ğ¾Ñ‚:**
```yaml
# 100 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ² Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ
requests: 100
period: "1m"

# 5 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ² ÑĞµĞºÑƒĞ½Ğ´Ñƒ
requests: 5
period: "1s"

# 1000 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ² Ñ‡Ğ°Ñ
requests: 1000
period: "1h"
```

### 3. Proxy Handler

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** ĞœĞ°Ñ€ÑˆÑ€ÑƒÑ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²

**ĞŸÑ€Ğ¾Ñ†ĞµÑÑ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸:**
```
1. ĞŸÑ€Ğ¸Ğ½ÑÑ‚ÑŒ HTTP POST Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ
   â†“
2. Ğ Ğ°ÑĞ¿Ğ°Ñ€ÑĞ¸Ñ‚ÑŒ JSON-RPC Ñ‚ĞµĞ»Ğ¾
   â†“
3. Ğ˜Ğ·Ğ²Ğ»ĞµÑ‡ÑŒ IP Ğ¸ Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²ĞºĞ¸
   â†“
4. ĞĞ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ÑŒ ClientIdentity
   â†“
5. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ rate limit
   â†“
6a. Ğ›Ğ¸Ğ¼Ğ¸Ñ‚ Ğ¿Ñ€ĞµĞ²Ñ‹ÑˆĞµĞ½ â†’ 429 Too Many Requests
6b. Ğ›Ğ¸Ğ¼Ğ¸Ñ‚ OK â†’ forward Ğº RPC Ğ½Ğ¾Ğ´Ğµ
   â†“
7. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¾Ñ‚Ğ²ĞµÑ‚ Ğ¾Ñ‚ Ğ½Ğ¾Ğ´Ñ‹
   â†“
8. Ğ’ĞµÑ€Ğ½ÑƒÑ‚ÑŒ Ğ¾Ñ‚Ğ²ĞµÑ‚ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ñƒ
```

**ĞšĞ¾Ğ´Ñ‹ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº:**
- `-32005`: Rate limit exceeded (ĞºĞ°ÑÑ‚Ğ¾Ğ¼Ğ½Ñ‹Ğ¹)
- `-32603`: Internal error (ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ğ¹ JSON-RPC)
- HTTP 429: Too Many Requests

### 4. Config Loader

**Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚:** YAML

**Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°:**
```yaml
server:
  host: string
  port: u16
  mode: "self-hosted" | "saas"

rpc_backend:
  url: string
  timeout_seconds: u64

rate_limits:
  default_ip_limit:
    requests: u32
    period: string
  method_limits:
    <method_name>:
      requests: u32
      period: string

api_keys:
  <key_value>:
    tier: "free" | "pro" | "enterprise"
    enabled: bool
    limits: {...}

blocklist:
  ips: [string]
  enable_auto_ban: bool
  auto_ban_threshold: u32

monitoring:
  prometheus_port: u16
  log_level: string
```

### 5. Stats Collector (Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ)

**ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ´Ğ»Ñ ÑĞ±Ğ¾Ñ€Ğ°:**
```
- rpc_requests_total (counter)
  labels: method, status, identity_type
  
- rate_limit_exceeded_total (counter)
  labels: identity, method
  
- rpc_request_duration_seconds (histogram)
  labels: method
  
- active_api_keys (gauge)
  
- blocked_ips_total (gauge)
```

**Ğ¥Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ:**
- In-Memory Ğ´Ğ»Ñ self-hosted (Ğ°Ğ³Ñ€ĞµĞ³Ğ°Ñ‚Ñ‹ Ğ·Ğ° Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ 24Ñ‡)
- Redis Ğ´Ğ»Ñ SaaS (Ñ€Ğ°ÑĞ¿Ñ€ĞµĞ´ĞµĞ»Ñ‘Ğ½Ğ½Ğ¾Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ)
- PostgreSQL Ğ´Ğ»Ñ Ğ±Ğ¸Ğ»Ğ»Ğ¸Ğ½Ğ³Ğ° (Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ audit trail)

## Ğ ĞµĞ¶Ğ¸Ğ¼Ñ‹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹

### Self-Hosted Mode

**Ğ¥Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ¸ÑÑ‚Ğ¸ĞºĞ¸:**
- ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ¸Ğ· YAML Ñ„Ğ°Ğ¹Ğ»Ğ°
- Ğ›Ğ¸Ğ¼Ğ¸Ñ‚ĞµÑ€Ñ‹ Ğ² Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ°
- Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ² stdout/logs
- ĞĞµÑ‚ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ² Ğ‘Ğ”

**Use case:**
- Ğ§Ğ°ÑÑ‚Ğ½Ñ‹Ğµ RPC Ğ½Ğ¾Ğ´Ñ‹
- Ğ’Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½Ğ¸Ğµ ĞºĞ¾Ñ€Ğ¿Ğ¾Ñ€Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ ÑĞµÑ‚Ğ¸
- Ğ Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¸ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

### SaaS Mode (Ğ² Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞµ)

**Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹:**
- PostgreSQL: Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸, Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸, Ğ±Ğ¸Ğ»Ğ»Ğ¸Ğ½Ğ³
- Redis: shared rate limiter state
- Admin REST API: ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼Ğ¸
- Stripe integration: Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ğ¸

**Use case:**
- ĞŸÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ RPC ÑĞµÑ€Ğ²Ğ¸Ñ
- API-as-a-Service
- ĞœĞ¾Ğ½ĞµÑ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ½Ğ¾Ğ´

## ĞŸĞ¾Ñ‚Ğ¾ĞºĞ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### Ğ£ÑĞ¿ĞµÑˆĞ½Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ

```
Client â†’ Proxy Handler
         â†“
      Identity Resolver (Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°)
         â†“
      Rate Limiter (Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ ĞºĞ²Ğ¾Ñ‚Ñƒ)
         â†“ PASS
      HTTP Client â†’ Backend RPC
         â†“
      Response
         â†“
      Client
```

### ĞÑ‚ĞºĞ»Ğ¾Ğ½Ñ‘Ğ½Ğ½Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ (Rate Limited)

```
Client â†’ Proxy Handler
         â†“
      Identity Resolver
         â†“
      Rate Limiter (quota exceeded)
         â†“ FAIL
      Stats Collector (increment counter)
         â†“
      429 Response â†’ Client
```

## ĞœĞ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

### Ğ’ĞµÑ€Ñ‚Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğµ

**Single Instance:**
- 10K-50K RPS Ğ½Ğ° ÑĞ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğ¼ CPU
- In-memory rate limiters (Ğ¾Ñ‡ĞµĞ½ÑŒ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾)
- ĞĞ¸Ğ·ĞºĞ°Ñ latency (~1-2ms overhead)

**ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸:**
- Async I/O (Tokio)
- Zero-copy Ğ³Ğ´Ğµ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾
- Connection pooling Ğº RPC Ğ½Ğ¾Ğ´Ğµ

### Ğ“Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ (SaaS)

**Multi-Instance Setup:**
```
            Load Balancer
                 |
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“            â†“            â†“
 Proxy-1     Proxy-2     Proxy-3
    |            |            |
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
            Redis Cluster
         (shared limiter state)
```

**Ğ¢Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ:**
- Redis Ğ´Ğ»Ñ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ rate limiters
- Session affinity Ğ½Ğµ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ
- Health checks Ğ´Ğ»Ñ auto-scaling

## Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ

### Rate Limiting ĞºĞ°Ğº Ğ¿ĞµÑ€Ğ²Ğ°Ñ Ğ»Ğ¸Ğ½Ğ¸Ñ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ñ‹

**Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚:**
- DDoS Ğ°Ñ‚Ğ°Ğº
- Spam Ğ¼ĞµÑ‚Ğ¾Ğ´Ğ¾Ğ² (eth_getLogs)
- Ğ ĞµÑÑƒÑ€ÑĞ¾Ñ‘Ğ¼ĞºĞ¸Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
- Bot-Ñ‚Ñ€Ğ°Ñ„Ğ¸ĞºĞ°

### Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ¼ĞµÑ€Ñ‹

**IP Blocklist:**
- Ğ¡Ñ‚Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… IP
- Auto-ban Ğ¿Ğ¾ threshold (Ğ² Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞµ)

**Method Filtering (Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞµ):**
- Blacklist Ğ¾Ğ¿Ğ°ÑĞ½Ñ‹Ñ… Ğ¼ĞµÑ‚Ğ¾Ğ´Ğ¾Ğ²
- Whitelist Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ€Ğ°Ğ·Ñ€ĞµÑˆÑ‘Ğ½Ğ½Ñ‹Ñ… Ğ¼ĞµÑ‚Ğ¾Ğ´Ğ¾Ğ²

**Request Validation:**
- JSON-RPC Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚
- Ğ Ğ°Ğ·Ğ¼ĞµÑ€ payload
- Signature verification (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)

## Ğ Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ñ

### WebSocket Support (Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ)

```rust
// ĞĞ¾Ğ²Ñ‹Ğ¹ handler Ğ´Ğ»Ñ ws://
async fn ws_proxy_handler() {
    // Upgrade connection
    // Forward eth_subscribe events
    // Maintain persistent connection
}
```

### Admin API (Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ)

**Endpoints:**
```
POST   /admin/api-keys              - Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ĞºĞ»ÑÑ‡
GET    /admin/api-keys/:id          - ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ĞºĞ»ÑÑ‡
PUT    /admin/api-keys/:id          - ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ñ‹
DELETE /admin/api-keys/:id          - Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ĞºĞ»ÑÑ‡
GET    /admin/stats/:id             - Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ¿Ğ¾ ĞºĞ»ÑÑ‡Ñƒ
POST   /admin/blocklist/add         - Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ IP Ğ² Ğ±Ğ»Ğ¾ĞºĞ»Ğ¸ÑÑ‚
```

**ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ:**
- JWT tokens
- Admin API key
- Role-based access control

### Machine Learning Integration (Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞµ)

**Bot Detection:**
- ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ğ¾Ğ² Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
- Anomaly detection
- Automated ban recommendations

**Traffic Prediction:**
- Forecast usage Ğ´Ğ»Ñ auto-scaling
- Predictive rate limiting
- Cost optimization

## ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¸ Observability

### Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

**Ğ£Ñ€Ğ¾Ğ²Ğ½Ğ¸:**
- ERROR: ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸
- WARN: Rate limits, suspicious activity
- INFO: Startup, config changes
- DEBUG: ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ (dev only)

**Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ»Ğ¾Ğ³Ğ¾Ğ²:**
```json
{
  "timestamp": "2025-01-28T10:30:00Z",
  "level": "WARN",
  "identity": "ip:1.2.3.4",
  "method": "eth_getLogs",
  "message": "Rate limit exceeded",
  "limit": "10/min",
  "current": 15
}
```

### ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ (Prometheus)

**Dashboard Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ĞµĞ»Ğ¸:**
- Requests per second Ğ¿Ğ¾ Ğ¼ĞµÑ‚Ğ¾Ğ´Ğ°Ğ¼
- Rate limit hit rate
- Backend latency
- Active connections
- Error rates

### ĞĞ»ĞµÑ€Ñ‚Ñ‹

**ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ:**
- Backend RPC Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½
- ĞÑˆĞ¸Ğ±ĞºĞ¸ > 5%
- Latency > 1s

**ĞŸÑ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ñ:**
- ĞĞµĞ¾Ğ±Ñ‹Ñ‡Ğ½Ñ‹Ğ¹ Ñ€Ğ¾ÑÑ‚ Ñ‚Ñ€Ğ°Ñ„Ğ¸ĞºĞ°
- ĞĞ¾Ğ²Ñ‹Ğµ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ Ğ°Ñ‚Ğ°Ğº
- ĞŸÑ€Ğ¸Ğ±Ğ»Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ Ğº Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ°Ğ¼ Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ²

## ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ

### Benchmarks (Ğ¾Ğ¶Ğ¸Ğ´Ğ°ĞµĞ¼Ñ‹Ğµ)

```
Throughput:  20,000 RPS (single instance)
Latency:     p50: 2ms, p99: 10ms (proxy overhead)
Memory:      ~100MB base + 1KB per active limiter
CPU:         ~30% Ğ½Ğ° 10K RPS (4 cores)
```

### ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

**Hotspots:**
1. Rate limiter lookup - O(1) HashMap
2. JSON parsing - Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ serde
3. HTTP forwarding - connection pooling

**ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸:**
- Batch processing Ğ´Ğ»Ñ stats
- LRU cache Ğ´Ğ»Ñ config
- Pre-compiled regex Ğ´Ğ»Ñ validation